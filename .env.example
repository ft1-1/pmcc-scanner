# PMCC Scanner Environment Configuration
# Copy this file to .env and fill in your actual values

# Application Environment
ENVIRONMENT=development
DEBUG=true

# ==============================================
# DATA PROVIDER CONFIGURATION
# ==============================================
# Provider system operation mode:
# - "factory": Use multi-provider factory system (recommended for new installations)
# - "legacy": Use single-provider approach (for backward compatibility)
# - "hybrid": Use hybrid approach with smart fallbacks
PROVIDER_MODE=factory

# Primary data provider (eodhd or marketdata)
# EODHD: Best for stock screening, comprehensive data
# MarketData: Best for real-time quotes and options data
PROVIDER_PRIMARY_PROVIDER=eodhd

# Fallback strategy when primary provider fails:
# - "operation_specific": Use best provider for each operation (recommended)
# - "primary_secondary": Try primary, then secondary
# - "round_robin": Try all providers in order
# - "none": No fallback, fail immediately
PROVIDER_FALLBACK_STRATEGY=operation_specific

# Operation-specific provider preferences
# Stock screening (only EODHD supported currently)
PROVIDER_PREFERRED_STOCK_SCREENER=eodhd
# Options data (both providers supported)
PROVIDER_PREFERRED_OPTIONS_PROVIDER=marketdata
# Stock quotes (both providers supported, MarketData faster)
PROVIDER_PREFERRED_QUOTES_PROVIDER=marketdata
# Greeks calculations (both providers supported, MarketData more accurate)
PROVIDER_PREFERRED_GREEKS_PROVIDER=marketdata

# Provider health monitoring
PROVIDER_ENABLE_HEALTH_CHECKS=true
PROVIDER_HEALTH_CHECK_INTERVAL_SECONDS=300
PROVIDER_CIRCUIT_BREAKER_FAILURE_THRESHOLD=5
PROVIDER_CIRCUIT_BREAKER_RECOVERY_TIMEOUT_SECONDS=600

# Performance settings
PROVIDER_MAX_CONCURRENT_REQUESTS_PER_PROVIDER=10
PROVIDER_REQUEST_TIMEOUT_SECONDS=30
PROVIDER_ENABLE_RESPONSE_CACHING=true
PROVIDER_CACHE_TTL_SECONDS=300

# Cost optimization
PROVIDER_PRIORITIZE_COST_EFFICIENCY=true
PROVIDER_MAX_DAILY_API_CREDITS=10000
PROVIDER_ALERT_THRESHOLD_CREDITS_REMAINING=1000

# Auto-detection settings
PROVIDER_AUTO_DETECT_PROVIDERS=true
PROVIDER_REQUIRE_PRIMARY_PROVIDER=true

# ==============================================
# API PROVIDER TOKENS
# ==============================================
# You need at least ONE of these API tokens for the system to work
# Both providers can be configured for optimal performance and redundancy

# MarketData.app API Configuration (optional but recommended)
# - Excellent for real-time quotes and options data
# - Supports batch requests for better performance
# - Lower latency for options chains and Greeks
MARKETDATA_API_TOKEN=your_marketdata_api_token_here
MARKETDATA_BASE_URL=https://api.marketdata.app
MARKETDATA_TIMEOUT_SECONDS=30
MARKETDATA_REQUESTS_PER_MINUTE=100
MARKETDATA_REQUESTS_PER_DAY=100000
MARKETDATA_MAX_RETRIES=3
MARKETDATA_RETRY_BACKOFF_FACTOR=2.0

# EODHD API Configuration (optional but recommended for screening)
# - Required for stock screening (only provider that supports screening)
# - Comprehensive historical data and fundamentals
# - Cost-effective for batch analysis
EODHD_API_TOKEN=your_eodhd_api_token_here
EODHD_BASE_URL=https://eodhd.com/api
EODHD_TIMEOUT_SECONDS=30
EODHD_MAX_RETRIES=3
EODHD_RETRY_BACKOFF_FACTOR=2.0
EODHD_SCREENER_CREDITS_PER_REQUEST=5
EODHD_MAX_SCREENER_REQUESTS_PER_DAY=2000

# MIGRATION NOTES FOR EXISTING USERS:
# - If you only have EODHD_API_TOKEN: System will work in single-provider mode
# - If you only have MARKETDATA_API_TOKEN: Stock screening will be limited
# - For best performance: Configure both tokens and use factory mode
# - Legacy configurations will continue to work automatically

# Notification Configuration
NOTIFICATION_WHATSAPP_ENABLED=true
NOTIFICATION_EMAIL_ENABLED=true

# Email notification behavior
# Enable comprehensive daily summary emails with all opportunities
NOTIFICATION_EMAIL_SEND_DAILY_SUMMARY=true
# Enable legacy individual email notifications per opportunity (deprecated)
NOTIFICATION_EMAIL_SEND_INDIVIDUAL_NOTIFICATIONS=false

# Notification content settings
# Include all opportunities in notifications vs top N only
NOTIFICATION_INCLUDE_ALL_OPPORTUNITIES=true

# Notification retry and fallback settings
NOTIFICATION_MAX_RETRIES=3
NOTIFICATION_RETRY_DELAY=60
NOTIFICATION_ENABLE_FALLBACK=true
NOTIFICATION_FALLBACK_DELAY=300

# Twilio/WhatsApp Settings
TWILIO_ACCOUNT_SID=your_twilio_account_sid
TWILIO_AUTH_TOKEN=your_twilio_auth_token
TWILIO_PHONE_NUMBER=+12345678901
# WhatsApp sender number with required whatsapp: prefix
TWILIO_WHATSAPP_FROM=whatsapp:+14155238886
WHATSAPP_TO_NUMBERS=+12345678901,+10987654321

# Mailgun/Email Settings (preferred)
MAILGUN_API_KEY=your_mailgun_api_key
MAILGUN_DOMAIN=your_mailgun_domain.com
EMAIL_FROM=scanner@yourdomain.com
EMAIL_FROM_NAME=PMCC Scanner
EMAIL_TO=alerts@yourdomain.com,trader@yourdomain.com

# SendGrid/Email Settings (backward compatibility - deprecated)
# SENDGRID_API_KEY=your_sendgrid_api_key

# Scan Configuration
SCAN_SCHEDULE_ENABLED=true
SCAN_TIME=09:30
SCAN_TIMEZONE=US/Eastern
SCAN_DEFAULT_UNIVERSE=EODHD_PMCC
SCAN_MAX_STOCKS_TO_SCREEN=5000
SCAN_CUSTOM_SYMBOLS=
SCAN_MIN_STOCK_PRICE=5.00
SCAN_MAX_STOCK_PRICE=500.00
SCAN_MIN_VOLUME=100000
SCAN_MIN_MARKET_CAP=50000000
SCAN_MAX_MARKET_CAP=5000000000

# LEAPS Criteria
SCAN_LEAPS_MIN_DTE=180
SCAN_LEAPS_MAX_DTE=365
SCAN_LEAPS_MIN_DELTA=0.70
SCAN_LEAPS_MAX_DELTA=0.95

# Short Call Criteria
SCAN_SHORT_MIN_DTE=30
SCAN_SHORT_MAX_DTE=45
SCAN_SHORT_MIN_DELTA=0.15
SCAN_SHORT_MAX_DELTA=0.40

# Risk Management
SCAN_MAX_RISK_PER_TRADE=0.02
SCAN_RISK_FREE_RATE=0.05
SCAN_MIN_LIQUIDITY_SCORE=60
SCAN_MIN_TOTAL_SCORE=70
SCAN_MAX_OPPORTUNITIES=25

# Output Settings
SCAN_EXPORT_RESULTS=true
# Export format: json, csv, or both
SCAN_EXPORT_FORMAT=json

# CSV Export Configuration
# Enable CSV export alongside JSON (when SCAN_EXPORT_FORMAT=json)
SCAN_EXPORT_CSV_ENABLED=true
# Enable detailed CSV with sub-scores and additional metrics
SCAN_EXPORT_CSV_DETAILED=false

# Legacy Options Data Source Configuration (deprecated - use PROVIDER_* settings above)
# These settings are maintained for backward compatibility
# New installations should use the PROVIDER_* settings above for better performance
SCAN_OPTIONS_SOURCE=marketdata
SCAN_USE_HYBRID_FLOW=false

# Tradetime Filtering Configuration
# Enable/disable tradetime filtering globally for improved performance
SCAN_ENABLE_TRADETIME_FILTERING=true
# Number of days to look back for trading dates (1-30)
SCAN_TRADETIME_LOOKBACK_DAYS=5
# Override tradetime filter date for testing (YYYY-MM-DD format, leave empty for automatic)
SCAN_CUSTOM_TRADETIME_DATE=

# Logging Configuration
LOG_LEVEL=INFO
LOG_FORMAT=%(asctime)s - %(name)s - %(levelname)s - %(message)s
LOG_ENABLE_FILE_LOGGING=true
LOG_FILE=logs/pmcc_scanner.log
LOG_MAX_BYTES=10485760
LOG_BACKUP_COUNT=5
LOG_ENABLE_CONSOLE_LOGGING=true
LOG_CONSOLE_LEVEL=INFO
LOG_ENABLE_JSON_LOGGING=false
LOG_INCLUDE_EXTRA_FIELDS=true
LOG_SYSLOG_ENABLED=false
LOG_SYSLOG_HOST=localhost
LOG_SYSLOG_PORT=514

# Database Configuration (for future use)
DATABASE_ENABLED=false
DATABASE_URL=
DATABASE_MAX_CONNECTIONS=10
DATABASE_CONNECTION_TIMEOUT=30

# Monitoring Configuration
MONITORING_ENABLED=true
MONITORING_HEALTH_CHECK_ENABLED=true
MONITORING_HEALTH_CHECK_PORT=8080
MONITORING_HEALTH_CHECK_PATH=/health
MONITORING_METRICS_ENABLED=false
MONITORING_METRICS_PORT=9090
MONITORING_METRICS_PATH=/metrics
MONITORING_TRACK_PERFORMANCE=true
MONITORING_SLOW_QUERY_THRESHOLD_SECONDS=5.0

# Circuit Breaker Settings
NOTIFICATION_WHATSAPP_FAILURE_THRESHOLD=3
NOTIFICATION_WHATSAPP_TIMEOUT_SECONDS=300
NOTIFICATION_EMAIL_FAILURE_THRESHOLD=5
NOTIFICATION_EMAIL_TIMEOUT_SECONDS=180